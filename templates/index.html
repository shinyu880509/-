<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>專題-股票分析</title>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC" rel="stylesheet">
<link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet" type="text/css" />      
</head>
<body>
    
<!----------------------------------------------------------->
<div id="wrapper">
    <!--------------------------header------------------------------->
            <div class="header" >
                <div class="login">
                    {% if current_user.is_authenticated %}
                    <div class="dropdown">
                        <button class="dropbtn"><img src="/static/images/user.png"  width="25" height="25"><a>{{current_user.id}}</a><img src="/static/images/down.png"  width="35" height="35"></button>
                        <div class="dropdown-content">
                            <a href="javascript:saveFav('setting')">Setting</a>
                            <a href="javascript:saveFav('logout')">Log Out</a>
                        </div>
                      </div>
                    {% endif %}
                </div>

                <div class="title">
                    <h1 class="title">資訊股分析網</h1>
                    <a href="javascript:saveFav('{{stock}}')"><img src="{{ url_for('static', filename='images/icon.png') }}"  width="47" height="47" class="avatar"></a>
                </div>      
            </div>
            <div class="fakeHeader" ></div>
    <!---------------------------header結束------------------------------>
        
    <!---------------------------sidebar1-------------------------------->
        <div class="sidebar1">
            <div class="bd-toc-item">
                <h3 class="title">
                    資訊股代號
                </h3>
                <h4 class="myfavorite">
                    我的最愛
                </h4>
                <div class="text">
                    <ul>
                        <li>
                        <h class="2427text" style="display: none;"><a href="javascript:saveFav('2427')">2427三商電 </a></h>
                        </li>
                        <li>
                        <h class="2453text"style="display: none;"><a href="javascript:saveFav('2453')">2453凌群 </a></h>
                        </li>
                        <li>
                        <h class="2468text"style="display: none;"><a href="javascript:saveFav('2468')">2468華經 </a></h>
                        </li>
                        <li>
                        <h class="2471text"style="display: none;"><a href="javascript:saveFav('2471')">2471資通 </a></h>
                        </li>
                        <li>
                        <h class="2480text"style="display: none;"><a href="javascript:saveFav('2480')">2480敦陽 </a></h>
                        </li>
                        <li>
                        <h class="3029text"style="display: none;"><a href="javascript:saveFav('3029')">3029零壹 </a></h>
                        </li>    
                        <li>
                        <h class="3130text"style="display: none;"><a href="javascript:saveFav('3130')">3130一零四 </a></h>
                        </li> 
                        <li>
                        <h class="4994text"style="display: none;"><a href="javascript:saveFav('4994')">4994傳奇 </a></h>
                        </li>        
                        <li>
                        <h class="5203text"style="display: none;"><a href="javascript:saveFav('5203')">5203訊連 </a></h>
                        </li>
                        <li>
                        <h class="6112text"style="display: none;"><a href="javascript:saveFav('6112')">6112聚碩 </a></h>
                        </li>
                        <li>
                        <h class="6183text"style="display: none;"><a href="javascript:saveFav('6183')">6183關貿 </a></h>
                        </li>
                        <li>
                        <h class="6214text"style="display: none;"><a href="javascript:saveFav('6214')">6214精誠 </a></h>
                        </li>       
                    </ul>
                    
                </div>
                <div class="img">
                    <ul>
                        <li>
                            <button class="but2427" style="display: none;" onclick="newFav('2427')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>
                        </li>
                        <li>
                            <button class="but2453" style="display: none;" onclick="newFav('2453')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="but2468" style="display: none;" onclick="newFav('2468')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="but2471" style="display: none;" onclick="newFav('2471')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="but2480" style="display: none;" onclick="newFav('2480')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="but3029" style="display: none;" onclick="newFav('3029')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="but3130" style="display: none;" onclick="newFav('3130')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="but4994" style="display: none;" onclick="newFav('4994')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="but5203" style="display: none;" onclick="newFav('5203')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="but6112" style="display: none;" onclick="newFav('6112')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="but6183" style="display: none;" onclick="newFav('6183')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="but6214" style="display: none;" onclick="newFav('6214')"><img src=" {{ url_for('static', filename='images/minus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                    </ul>    
                </div>
                <h4 class="otherstock">
                    所有代號
                </h4>
                <div class="text">
                    <ul>
                        <li>
                            <a class="text2427" href="javascript:saveFav('2427')">2427三商電 </a>
                        </li>
                        <li>
                            <a class="text2453" href="javascript:saveFav('2453')">2453凌群 </a>
                        </li>
                        <li>
                            <a class="text2468" href="javascript:saveFav('2468')">2468華經 </a>
                        </li>
                        <li>
                            <a class="text2471" href="javascript:saveFav('2471')">2471資通</a>
                        </li>
                        <li>
                            <a class="text2480" href="javascript:saveFav('2480')">2480敦陽</a>
                        </li>
                        <li>
                            <a class="text3029" href="javascript:saveFav('3029')">3029零壹 </a>
                        </li>
                        <li>
                            <a class="text3130" href="javascript:saveFav('3130')">3130一零四</a>
                        </li>
                        <li>
                            <a class="text4994" href="javascript:saveFav('4994')">4994傳奇 </a>
                        </li>
                        <li>
                            <a class="text5203" href="javascript:saveFav('5203')">5203訊連 </a>
                        </li>
                        <li>
                            <a class="text6112" href="javascript:saveFav('6112')">6112聚碩</a>
                        </li>
                        <li>
                            <a class="text6183" href="javascript:saveFav('6183')">6183關貿 </a>
                        </li>
                        <li>
                            <a class="text6214" href="javascript:saveFav('6214')">6214精誠 </a>
                        </li>
                    </ul>
                </div>
                <div class="img">
                    <ul>
                        <li>
                            <button class="button2427" onclick="newFav('2427')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>
                        </li>
                        <li>
                            <button class="button2453" onclick="newFav('2453')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="button2468" onclick="newFav('2468')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="button2471" onclick="newFav('2471')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="button2480" onclick="newFav('2480')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="button3029" onclick="newFav('3029')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="button3130" onclick="newFav('3130')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        </li>
                        <li>
                            <button class="button4994" onclick="newFav('4994')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="button5203" onclick="newFav('5203')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="button6112" onclick="newFav('6112')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="button6183" onclick="newFav('6183')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                        <li>
                            <button class="button6214" onclick="newFav('6214')"><img src=" {{ url_for('static', filename='images/plus.png'  ) }}  "width="10" height="10" class="plus"></a></button>                        
                        </li>
                    </ul>    
                </div>
            </div>
        </div>
      
    <!---------------------------sidebar1結束------------------------------>

    <!---------------------------新聞開始------------------------------->
    <div class="sidebar2">
        <div class="newstitle">
        <h2>新聞<img src="{{ url_for('static', filename='images/loudly.png') }}"  width="30" height="30"></h2>
        </div>
        <div class="newscontent">
        <ul>
        {% for i in range(n) %}
            <li>
                <a href = "{{news['網址'][i]}}" target="_blank">{{news['標題'][i]}}</a>
                <h5>{{news['來源'][i]}}  {{news['日期'][i]}}</h5>
            </li>
        {% endfor %}
        </ul>
        <a href = "javascript:saveFavNews('{{stock}}')">more...</a>
        </div>
    </div>
    <!---------------------------新聞結束------------------------------->
    
    <!---------------------------content開始------------------------------->
        <div class="content">
            <div class="title1"><h2>{{name}}</h2></div> 
    {% for i in range(5) %}
    {% if ind[i]==0 %}
    <!---------------------------第一塊圖表開始------------------------------->           
                <div class="newsbar">
                    <h2>走勢圖</h2>
                    <div class="button">
                        <button type="button1" class="today" onclick="butCha(0)">
                            昨日
                        </button>
                        {% if live[0] != "e" %}
                        <button type="button1" class="today" onclick="butCha(2)">
                            即時
                        </button>
                        {% endif %}
                        <button type="button1" class="today" onclick="butCha(1)">
                            近三十日
                        </button>
                    </div>
                    <!--<div class="navbar1">-->
                        <ul id="detail">
                            <li>開盤價:{{today[3][0]}}</li>
                            <li>最高價:{{today[3][1]}}</li>
                            <li>最低價:{{today[3][2]}}</li>
                            <li>收盤價:{{today[3][3]}}</li>
                            <li>總交易量:{{today[3][4]}}</li>
                        </ul>
                    <!--</div>-->
                    <div class="pic">
                        <canvas id="canvasCha"></canvas>
                    </div>
                </div>           
    <!---------------------------第一塊圖表結束------------------------------->      

    {% elif ind[i]==1 %}
    <!---------------------------第二塊預測開始------------------------------->
                <div class="newsbar">
                    <h2>預測分析</h2>
                    <h4 id="preTitle"></h4>
                    <div class="button">
                        <button type="button1" class="today" onclick="butPre(1)">
                            前一天
                        </button>
                        <button type="button1" class="today" onclick="butPre(2)">
                            後一天
                        </button>
                    </div>
                    
                    <div class="pic">
                        <canvas id="canvasPre"></canvas>
                        <div>
                            <h4 id="recommend">{{pre[1][0][0]}}</h4>
                        </div>
                    </div>
                    
                </div>                   
    <!---------------------------第二塊預測結束------------------------------->

    {% elif ind[i]==2 %}
    <!---------------------------第三塊財務分析開始------------------------------->
                <div class="newsbar">
                    <h2>財務分析</h2>
                    <div class="button">
                        <button type="button1" class="today" onclick="butFin(0)">
                            個股月營收
                        </button>
                        <button type="button1" class="today" onclick="butFin(1)">
                            成長性分析
                        </button>
                        <button type="button1" class="today" onclick="butFin(2)">
                            股利政策
                        </button>
                        <button type="button1" class="today" onclick="butFin(3)">
                            獲利能力分析(季)
                        </button>
                        <button type="button1" class="today" onclick="butFin(4)">
                            資本形成-股東權益(季)
                        </button>
                        <button type="button1" class="today" onclick="butFin(5)">
                            現今分析(年)
                        </button>
                        <button type="button1" class="today" onclick="butFin(6)">
                            償還能力分析(季)
                        </button>
                        <button type="button1" class="today" onclick="butFin(7)">
                            經營能力分析(年)
                        </button>
                    </div>
                    
                    <div class="pic">
                        <canvas id="canvasFin"></canvas>
                    </div>
                </div>           
    <!---------------------------第三塊財務分析結束------------------------------->

    {% elif ind[i]==3 %}
    <!---------------------------第四塊技術分析開始------------------------------->
                <div class="newsbar">
                    <h2>技術分析</h2>
                    <div class="button">
                        <button type="button1" class="today" onclick="butTec(0)">
                            RSI線
                        </button>
                        <button type="button1" class="today" onclick="butTec(1)">
                            KD線
                        </button>
                        <button type="button1" class="today" onclick="butTec(2)">
                            MACD線
                        </button>
                        <button type="button1" class="today" onclick="butTec(3)">
                            BIAS線
                        </button>
                    </div>
                    
                    <div class="pic">
                        <canvas id="canvasTec"></canvas>
                    </div>
                </div>                     
    <!---------------------------第四塊技術分析結束------------------------------->


    {% elif ind[i]==4 %}
    <!---------------------------第五塊圖表開始------------------------------->           
                <div class="newsbar" id="chat">
                    <h2 id="artcile">討論區</h2>
                    <div class="button">
                        <button type="button1" class="today" onclick="relist(0)">
                            回列表
                        </button>
                        <button id="postBut" type="button1" class="today" onclick="relist(1)">
                            發文
                        </button>
                        <button id="delBut" type="button1" class="today" onclick="delart()" style="display: none;">
                            刪除文章
                        </button>
                    </div>

                    <div>
                        <table id="outArt" style="font-size:18px;">
                            <tr>
                                <td width=60% id="back">標題</td>
                                <td id="back">帳號</td>
                                <td id="back">人氣</td>
                                <td id="back">最新回覆</td>
                            </tr>
                        {% for i in range(lenArt) %}
                            {% if i%2==0 %}
                            <tr>
                            {% else %}
                            <tr >
                            {% endif %}
                                <td width=60% class="back2" ><a href="javascript:intoArt({{i}})" style="color: rgb(142, 180, 236);">{{art[i][4]}}</a></td>
                                <td class="back2">{{art[i][0]}}</td>
                                <td id="outGd" class="back2">{{art[i][6]}}/{{art[i][7]}}</td>
                                <td class="back2">{{art[i][8][:19]}}</td>
                            </tr>
                        {% endfor %}
                        </table> 
                    </div>
                    <div>
                        <form method="post" action="/postReArt/{{stock}}">
                            <input name="artNum" id="artNum" style="display: none;">
                        <table id="inArt" bgcolor=white style="display: none;font-size:18px;" width=60%>
                            
                            <tr bgcolor=lightgray>
                                <td id="Atitle"></td>
                            </tr>
                            <tr>
                                <td id="Atext"></td>
                            </tr>
                            <tr>
                                <td><hr><button>like</button>&ensp;<a id="gd"></a>&ensp;&ensp;&ensp;<button>dislike</button>&ensp;<a id="bd"></a>&ensp;&ensp;&ensp;<a id="uid"></a>&ensp;&ensp;&ensp;<a id="poTime">發文時間:</a></td>
                            </tr>
                        </table>
                        </form>
                    </div>
                    <div id="postArt" style="display: none;">
                        <form method='post' action="/postArt/{{stock}}"> 
                            <select name="secTitle" style="font-size:18px;" required="required">
                                <option value="" style="display: none;">請選擇一個類別</option>
                                <option value="【綜合討論】">綜合討論</option>
                                <option value="【分享】">分享</option>
                                <option value="【心得】">心得</option>
                                <option value="【新聞】">新聞</option>
                            </select>
                            <input required="required" name="postTitle" type="text" placeholder="請輸入標題" autocomplete="off" style="font-size:18px;width: 40vw;">
                            <br>
                            <textarea required="required" name="postText" required  placeholder="請輸入內文" autocomplete="off" style="font-size:18px;height: 20vw;width: 50vw;resize: none;"></textarea>
                            <br>
                            <button>發送</button>
                        </form>
                    </div>
                </div>           
    <!---------------------------第五塊圖表結束------------------------------->     
    {% endif %}
    {% endfor %}
        <!---------------------------footer開始------------------------------->
        <div class="footer">
            &copyntubimd 109403組
        </div>
        <!---------------------------footer結束-------------------------------> 
    </div>
    <!---------------------------content結束------------------------------->
    
    
    
    </div>
    
    
    <!------------------wrapper範圍------------------------>
    
    
    <!---------------------------連結------------------------------->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>      
    <script src="{{ url_for('static', filename='scripts/main.js') }}"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.js"></script>
    <script type="text/javascript">
    var dateMon = {{re[7]|safe}};
    var closeMon= {{re[8]|safe}};
    var transMon = {{re[9]|safe}};
    var time = {{today[0]|safe}};
    var closetoday = {{today[1]|safe}};
    var transtoday = {{today[2]|safe}};
    var fav = {{reFav|safe}};

    {% if live[0] == "e" %}
    var datelive = [];
    var closelive= [];
    var translive = [];
    {% else %}
    var datelive = {{live[0]|safe}};
    var closelive= {{live[1]|safe}};
    var translive = {{live[2]|safe}};
    {% endif %}

    var realArtData = {{art|safe}};

    var chaNum = 0;
    var preNum = 0;
    var finNum = 0;
    var tecNum = 0;
    var chaReact = 0;
    var preReact = 0;
    var finReact = 0;
    var tecReact = 0;

    dataPath = 'http://127.0.0.2:5500/catStock/';
    dataFile = '2427today.csv';
    dataUrl = dataPath + dataFile;
    var ttt = [];
    var num = 0;

    function delart(){
        window.location.href="/delart/{{stock}}/" + realArtData[num][2];
    }

    var reArtList = {{reArt|safe}}
    var del = 0;
    var nowVew = 0;
    function relist(a){
        if (a==0 && nowVew == 1){
            nowVew = 0;
            $('#postBut').toggle();
            $('#outArt').toggle();
            $('#inArt').toggle();
            if (del == 1)
                $('#delBut').toggle();
        }
        else if (a==1 && nowVew == 0){
            nowVew = 2;
            $('#outArt').toggle();
            $('#postArt').toggle();
        }
        else if (a==0 && nowVew == 2){
            nowVew = 0;
            $('#outArt').toggle();
            $('#postArt').toggle();
        } 
    }

    var reArtNum=document.getElementById("artNum");

    function intoArt(no){
        nowVew = 1;
        num = no;
        if ("{{current_user.id}}" == realArtData[no][0]){
            $('#delBut').toggle();
            del = 1;
        }
        $('#postBut').toggle();
        $('#outArt').toggle();
        $('#inArt').toggle();
        $('#Atitle').empty();
        $('#Atext').empty();
        $('#gd').empty();
        $('#bd').empty();
        $('#uid').empty();
        $('#poTime').empty();
        $('#inArt').empty();
        $('#inArt').append('<tr bgcolor=lightgray><td id="Atitle"></td></tr><tr><td id="Atext"></td></tr><tr><td><hr><button type="button" onclick="gd(' + realArtData[no][2] + ')">like</button>&ensp;<a id="gd"></a>&ensp;&ensp;&ensp;<button type="button" onclick="bd(' + realArtData[no][2] + ')">dislike</button>&ensp;<a id="bd"></a>&ensp;&ensp;&ensp;<a id="uid"></a>&ensp;&ensp;&ensp;<a id="poTime">發文時間:</a></td></tr>');
        $('#Atitle').append(realArtData[no][4]);
        $('#Atext').append(realArtData[no][5]);
        $('#gd').append(realArtData[no][6]);
        $('#bd').append(realArtData[no][7]);
        $('#uid').append("id:"+realArtData[no][0]);
        $('#poTime').append("發文時間:"+realArtData[no][8]);
        
        for(var i=0; i<reArtList.length; i++){
            if (reArtList[i][2] == realArtData[no][2]){
                eee = reArtList[i][5].slice(0, 19);
                $('#inArt').append('<tr bgcolor=lightgray style="height: 2vw;" id="Arecom"><td>'+ reArtList[i][0] +'&ensp;'+ reArtList[i][4] +'&ensp;'+ eee +'</td></tr>');
            }
        }
        $('#inArt').append('<tr bgcolor=lightgray style="height: 2vw;"><td id="postCom"><input name="inputCom" type="text" placeholder="留言..." autocomplete="off" style="font-size:18px;width: 35vw;">&ensp;<button style="font-size:16px;">發送</button></td></tr>');
        reArtNum.value = realArtData[no][2];
    }

    function gd(no){
        window.location.href="/saveGd/{{stock}}/" + no + "/" + num;
    }
    function bd(no){
        window.location.href="/saveBd/{{stock}}/" + no + "/" + num;
    }

    fav.forEach(element => {
        var z = '.'+ element +'text'
        var a = '.'+ 'but' +element
        var b = '.'+ 'text' +element
        var c = '.'+ 'button' +element
        $(z).toggle(); 
        $(a).toggle(); 
        $(b).toggle(); 
        $(c).toggle(); 
    });

    function newFav(aa){
        if (fav.indexOf(aa) == -1)
            fav.push(aa);
        else
            fav.splice(fav.indexOf(aa),1);
    }

    function saveFav(aa){
        if (fav.length == 0){
            if (aa == "logout")
                window.location.href="/newFav/logout/" + aa + "/non";
            else if (aa == "setting")
                window.location.href="/newFav/setting/" + aa + "/non";
            else
                window.location.href="/newFav/index/" + aa + "/non";
        }
        else if (aa == "logout")
            window.location.href="/newFav/logout/" + aa + "/" + fav.join("-");
        else if (aa == "setting")
            window.location.href="/newFav/setting/" + aa + "/" + fav.join("-");
        else
            window.location.href="/newFav/index/" + aa + "/" + fav.join("-");
    }

    function saveFavNews(aa){
        if (fav.length == 0)
            window.location.href="/newFav/news/" + aa + "/non";
        else
            window.location.href="/newFav/news/" + aa + "/" + fav.join("-");
    }

    $('#detail').empty();
    $('#detail').append("<ul id='detail'><li>開盤價:{{today[3][0]}}</li><li>最高價:{{today[3][1]}}</li><li>最低價:{{today[3][2]}}</li><li>收盤價:{{today[3][3]}}</li><li>總交易量:{{today[3][4]}}</li></ul>");
    $('#recommend').empty();
    $('#recommend').append("<h4 id='recommend'>{{pre[1][0][0]}}</h4>");
    $('#preTitle').empty();
    $('#preTitle').append("<h4 id='preTitle'>{{pre[0][0][5][0]}}~{{pre[0][0][5][29]}}</h4>");
    function butCha(aa){
        chaNum = aa;
        var chartDay = {
        labels: time, //顯示區間名稱
        datasets: [{
            type: 'line',
            label: '收盤價', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 2,
            data: closetoday, // 資料
            fill: false, // 是否填滿色彩
        },{
            type: 'bar',
            label: '交易量', // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 1,
            data: transtoday, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
        }]
        };

        var chartMon = {
            labels: dateMon, //顯示區間名稱
            datasets: [{
                type: 'line',
                label: '收盤價', // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth:2,
                data: closeMon, // 資料
                fill: false, // 是否填滿色彩
            },{
                type: 'bar',
                label: '交易量', // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: transMon, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            }]
        };
        var chartLive = {
            labels: datelive, //顯示區間名稱
            datasets: [{
                type: 'line',
                label: '收盤價', // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth: 2,
                data: closelive, // 資料
                fill: false, // 是否填滿色彩
            },{
                type: 'bar',
                label: '交易量', // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: translive, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            }]
        };

        $('#detail').empty();
        if (aa == 1){
            $('#detail').append("<ul id='detail'><li>成交量:{{re[0]}}</li><li>成交金額:{{re[1]}}</li><li>成交筆數:{{re[2]}}</li><li>最高:{{re[3]}}</li><li>最低:{{re[4]}}</li><li>漲跌:{{re[5]}}</li><li>均價:{{re[6]}}</li></ul>");
            if (document.cookie.match(/cha=([^;]+)(;|$)/) != null && chaReact == 0){
                drawCha = new Chart(ctxCha,{data: chartMon,options: opNo});
            }
            drawCha.data = chartMon;
        }
        else if (aa == 0){
            $('#detail').append("<ul id='detail'><li>開盤價:{{today[3][0]}}</li><li>最高價:{{today[3][1]}}</li><li>最低價:{{today[3][2]}}</li><li>收盤價:{{today[3][3]}}</li><li>總交易量:{{today[3][4]}}</li></ul>");
            if (document.cookie.match(/cha=([^;]+)(;|$)/) != null && chaReact == 0){
                drawCha = new Chart(ctxCha,{data: chartDay,options: opNo});
            }
            drawCha.data = chartDay;
        }
        else if (aa == 2){
            $('#detail').append("<li>開盤價:{{live[3][0]}}</li><li>最高價:{{live[3][1]}}</li><li>最低價:{{live[3][2]}}</li><li>最新一筆交易價格:{{live[3][3]}}</li><li>最新一筆交易量:{{live[3][4]}}</li><li>更新時間:{{live[3][5]}}</li>");
            if (document.cookie.match(/cha=([^;]+)(;|$)/) != null && chaReact == 0){
                drawCha = new Chart(ctxCha,{data: chartLive,options: opNo});
            }
            drawCha.data = chartLive;
        }

        
        if (chaReact == 1)
            drawCha.options = opAni;
            //drawCha = new Chart(ctxCha,{data: chartDay,options: op});
        chaReact = 1

        drawCha.update();
    }

    var preDay = 0;
    function butPre(aa){
        $('#recommend').empty();
        $('#preTitle').empty();
        if (aa == 1 && preDay < 9)
            preDay +=1;
        else if (aa == 1 && preDay >= 9)
            alert("只有最近十天的記錄");
        if (aa == 2 && preDay > 0)
            preDay -=1;
        else if  (aa == 2 && preDay == 0)
            alert("此為最新資料");
        preNum = preDay;
        if (preDay == 0){
            datePre = {{pre[0][0][5]|safe}};
            closePre= {{pre[0][0][1]|safe}};
            transPre = {{pre[1][0][1]|safe}};
            $('#recommend').append("<h4 id='recommend'>{{pre[1][0][0]}}</h4>");
            $('#preTitle').append("<h4 id='preTitle'>{{pre[0][0][5][0]}}~{{pre[0][0][5][29]}}</h4>");
        }
        else if (preDay == 1){
            datePre = {{pre[0][1][5]|safe}};
            closePre= {{pre[0][1][1]|safe}};
            transPre = {{pre[1][1][1]|safe}};
            $('#recommend').append("<h4 id='recommend'>{{pre[1][1][0]}}</h4>");
            $('#preTitle').append("<h4 id='preTitle'>{{pre[0][1][5][0]}}~{{pre[0][1][5][29]}}</h4>");
        }
        else if (preDay == 2){
            datePre = {{pre[0][2][5]|safe}};
            closePre= {{pre[0][2][1]|safe}};
            transPre = {{pre[1][2][1]|safe}};
            $('#recommend').append("<h4 id='recommend'>{{pre[1][2][0]}}</h4>");
            $('#preTitle').append("<h4 id='preTitle'>{{pre[0][2][5][0]}}~{{pre[0][2][5][29]}}</h4>");
        }
        else if (preDay == 3){
            datePre = {{pre[0][3][5]|safe}};
            closePre= {{pre[0][3][1]|safe}};
            transPre = {{pre[1][3][1]|safe}};
            $('#recommend').append("<h4 id='recommend'>{{pre[1][3][0]}}</h4>");
            $('#preTitle').append("<h4 id='preTitle'>{{pre[0][3][5][0]}}~{{pre[0][3][5][29]}}</h4>");
        }
        else if (preDay == 4){
            datePre = {{pre[0][4][5]|safe}};
            closePre= {{pre[0][4][1]|safe}};
            transPre = {{pre[1][4][1]|safe}};
            $('#recommend').append("<h4 id='recommend'>{{pre[1][4][0]}}</h4>");
            $('#preTitle').append("<h4 id='preTitle'>{{pre[0][4][5][0]}}~{{pre[0][4][5][29]}}</h4>");
        }
        else if (preDay == 5){
            datePre = {{pre[0][5][5]|safe}};
            closePre= {{pre[0][5][1]|safe}};
            transPre = {{pre[1][5][1]|safe}};
            $('#recommend').append("<h4 id='recommend'>{{pre[1][5][0]}}</h4>");
            $('#preTitle').append("<h4 id='preTitle'>{{pre[0][5][5][0]}}~{{pre[0][5][5][29]}}</h4>");
        }
        else if (preDay == 6){
            datePre = {{pre[0][6][5]|safe}};
            closePre= {{pre[0][6][1]|safe}};
            transPre = {{pre[1][6][1]|safe}};
            $('#recommend').append("<h4 id='recommend'>{{pre[1][6][0]}}</h4>");
            $('#preTitle').append("<h4 id='preTitle'>{{pre[0][6][5][0]}}~{{pre[0][6][5][29]}}</h4>");
        }
        else if (preDay == 7){
            datePre = {{pre[0][7][5]|safe}};
            closePre= {{pre[0][7][1]|safe}};
            transPre = {{pre[1][7][1]|safe}};
            $('#recommend').append("<h4 id='recommend'>{{pre[1][7][0]}}</h4>");
            $('#preTitle').append("<h4 id='preTitle'>{{pre[0][7][5][0]}}~{{pre[0][7][5][29]}}</h4>");
        }
        else if (preDay == 8){
            datePre = {{pre[0][8][5]|safe}};
            closePre= {{pre[0][8][1]|safe}};
            transPre = {{pre[1][8][1]|safe}};
            $('#recommend').append("<h4 id='recommend'>{{pre[1][8][0]}}</h4>");
            $('#preTitle').append("<h4 id='preTitle'>{{pre[0][8][5][0]}}~{{pre[0][8][5][29]}}</h4>");
        }
        else if (preDay == 9){
            datePre = {{pre[0][9][5]|safe}};
            closePre= {{pre[0][9][1]|safe}};
            transPre = {{pre[1][9][1]|safe}};
            $('#recommend').append("<h4 id='recommend'>{{pre[1][9][0]}}</h4>");
            $('#preTitle').append("<h4 id='preTitle'>{{pre[0][9][5][0]}}~{{pre[0][9][5][29]}}</h4>");
        }
        chartDataPre = {
        labels: datePre, //顯示區間名稱
        datasets: [{
            type: 'line',
            label: '收盤價', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 2,
            data: closePre, // 資料
            fill: false, // 是否填滿色彩
        },{
                type: 'line',
                label: 'rsi', // tootip 出現的名稱
                lineTension: 0,
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: transPre, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            }]
        };
        if (document.cookie.match(/pre=([^;]+)(;|$)/) != null && preReact == 0){
            drawPre = new Chart(ctxPre,{data: chartDataPre,options: opNo});
        }
        if (preReact == 1)
            drawPre.options = opAni;
        preReact = 1
        drawPre.data = chartDataPre;
        drawPre.update();
    }

    function butFin(aa){
        finNum = aa;
        if (aa == 0){
            time1 = {{fin[0][1][0]|safe}};
            data1 = {{fin[0][1][1]|safe}};
            data2 = {{fin[0][1][2]|safe}};
            data3 = {{fin[0][1][3]|safe}};
            data4 = {{fin[0][1][4]|safe}};
            data5 = {{fin[0][1][5]|safe}};
            data6 = {{fin[0][1][6]|safe}};
            data7 = {{fin[0][1][7]|safe}};
            name1 = {{fin[0][0]|safe}};
        }
        else if (aa == 1){
            time1 = {{fin[1][1][0]|safe}};
            data1 = {{fin[1][1][1]|safe}};
            data2 = {{fin[1][1][2]|safe}};
            data3 = {{fin[1][1][3]|safe}};
            data4 = {{fin[1][1][4]|safe}};
            data5 = {{fin[1][1][5]|safe}};
            data6 = {{fin[1][1][6]|safe}};
            data7 = {{fin[1][1][7]|safe}};
            name1 = {{fin[1][0]|safe}};
        }
        else if (aa == 2){
            time1 = {{fin[2][1][0]|safe}};
            data1 = {{fin[2][1][1]|safe}};
            data2 = {{fin[2][1][2]|safe}};
            data3 = {{fin[2][1][3]|safe}};
            data4 = {{fin[2][1][4]|safe}};
            data5 = {{fin[2][1][5]|safe}};
            data6 = {{fin[2][1][6]|safe}};
            data7 = {{fin[2][1][7]|safe}};
            name1 = {{fin[2][0]|safe}};
        }
        else if (aa == 3){
            time1 = {{fin[3][1][0]|safe}};
            data1 = {{fin[3][1][1]|safe}};
            data2 = {{fin[3][1][2]|safe}};
            data3 = {{fin[3][1][3]|safe}};
            data4 = {{fin[3][1][4]|safe}};
            data5 = {{fin[3][1][5]|safe}};
            data6 = {{fin[3][1][6]|safe}};
            data7 = {{fin[3][1][7]|safe}};
            name1 = {{fin[3][0]|safe}};
        }
        else if (aa == 4){
            time1 = {{fin[4][1][0]|safe}};
            data1 = {{fin[4][1][1]|safe}};
            data2 = {{fin[4][1][2]|safe}};
            data3 = {{fin[4][1][3]|safe}};
            data4 = {{fin[4][1][4]|safe}};
            data5 = {{fin[4][1][5]|safe}};
            data6 = {{fin[4][1][6]|safe}};
            data7 = {{fin[4][1][7]|safe}};
            name1 = {{fin[4][0]|safe}};
        }
        else if (aa == 5){
            time1 = {{fin[5][1][0]|safe}};
            data1 = {{fin[5][1][1]|safe}};
            data2 = {{fin[5][1][2]|safe}};
            data3 = {{fin[5][1][3]|safe}};
            data4 = {{fin[5][1][4]|safe}};
            data5 = {{fin[5][1][5]|safe}};
            data6 = {{fin[5][1][6]|safe}};
            data7 = {{fin[5][1][7]|safe}};
            name1 = {{fin[5][0]|safe}};
        }
        else if (aa == 6){
            time1 = {{fin[6][1][0]|safe}};
            data1 = {{fin[6][1][1]|safe}};
            data2 = {{fin[6][1][2]|safe}};
            data3 = {{fin[6][1][3]|safe}};
            data4 = {{fin[6][1][4]|safe}};
            data5 = {{fin[6][1][5]|safe}};
            data6 = {{fin[6][1][6]|safe}};
            data7 = {{fin[6][1][7]|safe}};
            name1 = {{fin[6][0]|safe}};
        }
        else if (aa == 7){
            time1 = {{fin[7][1][0]|safe}};
            data1 = {{fin[7][1][1]|safe}};
            data2 = {{fin[7][1][2]|safe}};
            data3 = {{fin[7][1][3]|safe}};
            data4 = {{fin[7][1][4]|safe}};
            data5 = {{fin[7][1][5]|safe}};
            data6 = {{fin[7][1][6]|safe}};
            data7 = {{fin[7][1][7]|safe}};
            name1 = {{fin[7][0]|safe}};
        }
        chartData1 = {
        labels: time1, //顯示區間名稱
        datasets: [{
            type: 'bar',
            label: name1[1], // tootip 出現的名稱
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 5,
            data: data1, // 資料
            fill: false, // 是否填滿色彩
        },{
            type: 'bar',
            label: name1[2], // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: data2, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
            lineTension: 0, // 曲線的彎度，設0 表示直線
        },{
            type: 'bar',
            label: name1[3], // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: data3, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
            lineTension: 0, // 曲線的彎度，設0 表示直線
        },{
            type: 'bar',
            label: name1[4], // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: data4, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
            lineTension: 0, // 曲線的彎度，設0 表示直線
        },{
            type: 'bar',
            label: name1[5], // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: data5, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
            lineTension: 0, // 曲線的彎度，設0 表示直線
        }]
        };
        var chartData2 = {
            labels: time1, //顯示區間名稱
            datasets: [{
                type: 'bar',
                label: name1[1], // tootip 出現的名稱
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth: 5,
                data: data1, // 資料
                fill: false, // 是否填滿色彩
            },{
                type: 'bar',
                label: name1[2], // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data2, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            },{
                type: 'bar',
                label: name1[3], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data3, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            },{
                type: 'bar',
                label: name1[4], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data4, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            }]
        };

        var chartData3 = {
            labels: time1, //顯示區間名稱
            datasets: [{
                type: 'bar',
                label: name1[1], // tootip 出現的名稱
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth: 5,
                data: data1, // 資料
                fill: false, // 是否填滿色彩
            },{
                type: 'bar',
                label: name1[2], // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data2, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            },{
                type: 'bar',
                label: name1[3], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data3, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            },{
                type: 'bar',
                label: name1[4], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data4, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            },{
                type: 'bar',
                label: name1[5], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data5, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            },{
                type: 'bar',
                label: name1[6], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data6, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            },{
                type: 'bar',
                label: name1[7], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data7, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            }]
        };

        var chartData4 = {
            labels: time1, //顯示區間名稱
            datasets: [{
                type: 'bar',
                label: name1[1], // tootip 出現的名稱
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth: 5,
                data: data1, // 資料
                fill: false, // 是否填滿色彩
            },{
                type: 'bar',
                label: name1[2], // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data2, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            },{
                type: 'bar',
                label: name1[3], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data3, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            },{
                type: 'bar',
                label: name1[4], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data4, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            },{
                type: 'bar',
                label: name1[5], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data5, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            }]
        };

        var chartData5 = {
            labels: time1, //顯示區間名稱
            datasets: [{
                type: 'bar',
                label: name1[1], // tootip 出現的名稱
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth: 5,
                data: data1, // 資料
                fill: false, // 是否填滿色彩
            },{
                type: 'bar',
                label: name1[2], // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data2, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            },{
                type: 'bar',
                label: name1[3], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data3, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            }]
        };

        var chartData6 = {
            labels: time1, //顯示區間名稱
            datasets: [{
                type: 'bar',
                label: name1[1], // tootip 出現的名稱
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth: 5,
                data: data1, // 資料
                fill: false, // 是否填滿色彩
            },{
                type: 'bar',
                label: name1[2], // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data2, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            },{
                type: 'bar',
                label: name1[3], // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data3, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
                lineTension: 0, // 曲線的彎度，設0 表示直線
            }]
        };

        var chartData7 = {
            labels: time1, //顯示區間名稱
            datasets: [{
                type: 'bar',
                label: name1[1], // tootip 出現的名稱
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth: 5,
                data: data1, // 資料
                fill: false, // 是否填滿色彩
            },{
                type: 'bar',
                label: name1[2], // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: data2, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            }]
        };

        var chartData8 = {
            labels: time1, //顯示區間名稱
            datasets: [{
                type: 'bar',
                label: name1[1], // tootip 出現的名稱
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth: 5,
                data: data1, // 資料
                fill: false, // 是否填滿色彩
            }]
        };

        if (document.cookie.match(/fin=([^;]+)(;|$)/) != null && finReact == 0){
                drawFin = new Chart(ctxFin,{data: chartData1,options: opNo});
        }
        if (finReact == 1)
            drawFin.options = opAni;
        finReact = 1
        
        if (aa == 0)
            drawFin.data = chartData1;
        else if (aa == 1)
            drawFin.data = chartData2;
        else if (aa == 2)
            drawFin.data = chartData3;
        else if (aa == 3)
            drawFin.data = chartData4;
        else if (aa == 4)
            drawFin.data = chartData5;
        else if (aa == 5)
            drawFin.data = chartData6;
        else if (aa == 6)
            drawFin.data = chartData7;
        else if (aa == 7)
            drawFin.data = chartData8;
        drawFin.update();
    }

    function butTec(aa){
        tecNum = aa;
        chartRsi = {
        labels: dateMon, //顯示區間名稱
        datasets: [{
            type: 'line',
            label: '收盤價', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 2,
            data: closeMon, // 資料
            fill: false, // 是否填滿色彩
        },{
            type: 'bar',
            label: '交易量', // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: transMon, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
        },{
            type: 'line',
            label: 'rsi', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#f57f24",
            borderColor: "#f57f24",
            borderWidth: 2,
            data: rsi, // 資料
            fill: false, // 是否填滿色彩
        }]
        };

        chartKd = {
            labels: dateMon, //顯示區間名稱
            datasets: [{
                type: 'line',
                label: '收盤價', // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth: 2,
                data: closeMon, // 資料
                fill: false, // 是否填滿色彩
            },
            {
                type: 'bar',
                label: '交易量', // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: transMon, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            },
            {
                type: 'line',
                label: 'k', // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#f5cf24",
                borderColor: "#f5cf24",
                borderWidth: 2,
                data: k, // 資料
                fill: false, // 是否填滿色彩
            },
            {
                type: 'line',
                label: 'd', // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#f57f24",
                borderColor: "#f57f24",
                borderWidth: 2,
                data: d, // 資料
                fill: false, // 是否填滿色彩
            }]
        };

        chartMacd = {
            labels: dateMon, //顯示區間名稱
            datasets: [{
                type: 'line',
                label: '收盤價', // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth: 2,
                data: closeMon, // 資料
                fill: false, // 是否填滿色彩
            },{
                type: 'bar',
                label: '交易量', // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: transMon, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            },
            {
                type: 'line',
                label: 'macd', // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#f5cf24",
                borderColor: "#f5cf24",
                borderWidth: 2,
                data: macd, // 資料
                fill: false, // 是否填滿色彩
            },
            {
                type: 'line',
                label: 'dif', // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#f57f24",
                borderColor: "#f57f24",
                borderWidth: 2,
                data: dif, // 資料
                fill: false, // 是否填滿色彩
            }]
        };

        chartBias = {
            labels: dateMon, //顯示區間名稱
            datasets: [{
                type: 'line',
                label: '收盤價', // tootip 出現的名稱
                lineTension: 0, // 曲線的彎度，設0 表示直線
                backgroundColor: "#ea464d",
                borderColor: "#ea464d",
                borderWidth: 2,
                data: closeMon, // 資料
                fill: false, // 是否填滿色彩
            },
            {
                type: 'bar',
                label: '交易量', // tootip 出現的名稱
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 2,
                data: transMon, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            },
            {
                type: 'bar',
                label: 'bias', // tootip 出現的名稱
                backgroundColor: "#f57f24",
                borderColor: "#f57f24",
                borderWidth: 2,
                data: bias, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            }]
        };
        if (document.cookie.match(/tec=([^;]+)(;|$)/) != null && tecReact == 0){
                drawTec = new Chart(ctxTec,{data: chartRsi,options: opNo});
        }
        if (tecReact == 1)
            drawTec.options = opAni;
        tecReact = 1

        if (aa == 0)
            drawTec.data = chartRsi;
        else if (aa == 1)
            drawTec.data = chartKd;
        else if (aa == 2)
            drawTec.data = chartMacd;
        else if (aa == 3)
            drawTec.data = chartBias;
        drawTec.update();
    }

    function clearCanvas(){
        ctxCha.remove(); // this is my <canvas> element
        
    }
    

    var chartLive = {
        labels: datelive, //顯示區間名稱
        datasets: [{
            type: 'line',
            label: '收盤價', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 5,
            data: closelive, // 資料
            fill: false, // 是否填滿色彩
        },{
            type: 'bar',
            label: '交易量', // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: translive, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
        }]
    };

    var chartDay = {
        labels: time, //顯示區間名稱
        datasets: [{
            type: 'line',
            label: '收盤價', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 5,
            data: closetoday, // 資料
            fill: false, // 是否填滿色彩
        },{
            type: 'bar',
            label: '交易量', // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: transtoday, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
        }]
    };

    var chartMon = {
        labels: dateMon, //顯示區間名稱
        datasets: [{
            type: 'line',
            label: '收盤價', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 5,
            data: closeMon, // 資料
            fill: false, // 是否填滿色彩
        },{
            type: 'bar',
            label: '交易量', // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: transMon, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
        }]
    };

    var datePre = {{pre[0][0][5]|safe}};
    var closePre= {{pre[0][0][1]|safe}};
    var transPre = {{pre[1][0][1]|safe}};

    var chartDataPre = {
        labels: datePre, //顯示區間名稱
        datasets: [{
            type: 'line',
            label: '收盤價', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 5,
            data: closePre, // 資料
            fill: false, // 是否填滿色彩
        },{
                type: 'line',
                label: 'rsi', // tootip 出現的名稱
                lineTension: 0,
                backgroundColor: "#055ffa",
                borderColor: "#055ffa",
                borderWidth: 5,
                data: transPre, // 資料
                fill: false, // 是否填滿色彩
                yAxisID: 'y-axis-1',
            }]
    };

    var time1 = {{fin[0][1][0]|safe}};
    var data1 = {{fin[0][1][1]|safe}};
    var data2 = {{fin[0][1][2]|safe}};
    var data3 = {{fin[0][1][3]|safe}};
    var data4 = {{fin[0][1][4]|safe}};
    var data5 = {{fin[0][1][5]|safe}};
    var data6 = {{fin[0][1][6]|safe}};
    var data7 = {{fin[0][1][7]|safe}};
    var name1 = {{fin[0][0]|safe}};

    var chartData1 = {
        labels: time1, //顯示區間名稱
        datasets: [{
            type: 'bar',
            label: name1[1], // tootip 出現的名稱
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 5,
            data: data1, // 資料
            fill: false, // 是否填滿色彩
        },{
            type: 'bar',
            label: name1[2], // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: data2, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
            lineTension: 0, // 曲線的彎度，設0 表示直線
        },{
            type: 'bar',
            label: name1[3], // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: data3, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
            lineTension: 0, // 曲線的彎度，設0 表示直線
        },{
            type: 'bar',
            label: name1[4], // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: data4, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
            lineTension: 0, // 曲線的彎度，設0 表示直線
        },{
            type: 'bar',
            label: name1[5], // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: data5, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
            lineTension: 0, // 曲線的彎度，設0 表示直線
        }]
        };


    var rsi = {{tec[0]|safe}};
    var k = {{tec[1]|safe}};
    var d = {{tec[2]|safe}};
    var dif = {{tec[3]|safe}};
    var macd = {{tec[4]|safe}};
    var bias = {{tec[5]|safe}};

    var chartRsi = {
        labels: dateMon, //顯示區間名稱
        datasets: [{
            type: 'line',
            label: '收盤價', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 5,
            data: closeMon, // 資料
            fill: false, // 是否填滿色彩
        },{
            type: 'bar',
            label: '交易量', // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: transMon, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
        },{
            type: 'line',
            label: 'rsi', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#f57f24",
            borderColor: "#f57f24",
            borderWidth: 5,
            data: rsi, // 資料
            fill: false, // 是否填滿色彩
        }]
    };

    var chartKd = {
        labels: dateMon, //顯示區間名稱
        datasets: [{
            type: 'line',
            label: '收盤價', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 5,
            data: closeMon, // 資料
            fill: false, // 是否填滿色彩
        },
        {
            type: 'bar',
            label: '交易量', // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: transMon, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
        },
        {
            type: 'line',
            label: 'k', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#f5cf24",
            borderColor: "#f5cf24",
            borderWidth: 5,
            data: k, // 資料
            fill: false, // 是否填滿色彩
        },
        {
            type: 'line',
            label: 'd', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#f57f24",
            borderColor: "#f57f24",
            borderWidth: 5,
            data: d, // 資料
            fill: false, // 是否填滿色彩
        }]
    };

    var chartMacd = {
        labels: dateMon, //顯示區間名稱
        datasets: [{
            type: 'line',
            label: '收盤價', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 5,
            data: closeMon, // 資料
            fill: false, // 是否填滿色彩
        },{
            type: 'bar',
            label: '交易量', // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: transMon, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
        },
        {
            type: 'line',
            label: 'macd', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#f5cf24",
            borderColor: "#f5cf24",
            borderWidth: 5,
            data: macd, // 資料
            fill: false, // 是否填滿色彩
        },
        {
            type: 'line',
            label: 'dif', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#f57f24",
            borderColor: "#f57f24",
            borderWidth: 5,
            data: dif, // 資料
            fill: false, // 是否填滿色彩
        }]
    };

    var chartBias = {
        labels: dateMon, //顯示區間名稱
        datasets: [{
            type: 'line',
            label: '收盤價', // tootip 出現的名稱
            lineTension: 0, // 曲線的彎度，設0 表示直線
            backgroundColor: "#ea464d",
            borderColor: "#ea464d",
            borderWidth: 5,
            data: closeMon, // 資料
            fill: false, // 是否填滿色彩
        },
        {
            type: 'bar',
            label: '交易量', // tootip 出現的名稱
            backgroundColor: "#055ffa",
            borderColor: "#055ffa",
            borderWidth: 2,
            data: transMon, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
        },
        {
            type: 'bar',
            label: 'bias', // tootip 出現的名稱
            backgroundColor: "#f57f24",
            borderColor: "#f57f24",
            borderWidth: 2,
            data: bias, // 資料
            fill: false, // 是否填滿色彩
            yAxisID: 'y-axis-1',
        }]
    };

    var ctxCha = document.getElementById("canvasCha").getContext("2d");
    var ctxPre = document.getElementById("canvasPre").getContext("2d");
    var ctxFin = document.getElementById("canvasFin").getContext("2d");
    var ctxTec = document.getElementById("canvasTec").getContext("2d");

    var opNo = {
            animation: false ,
            responsive: true,
            legend: { //是否要顯示圖示
                display: true,
            },
            tooltips: { //是否要顯示 tooltip
                enabled: true
            },
            scales: {  //是否要顯示 x、y 軸
                xAxes: [{
                    display: true
                },],
                yAxes: [{
                    display: true
                },{
                    id: 'y-axis-1',
                    position: 'right',
                    display: true
                }]
            },
        };
    var opAni = {
        //animation: false ,
        responsive: true,
        legend: { //是否要顯示圖示
            display: true,
        },
        tooltips: { //是否要顯示 tooltip
            enabled: true
        },
        scales: {  //是否要顯示 x、y 軸
            xAxes: [{
                display: true
            },],
            yAxes: [{
                display: true
            },{
                id: 'y-axis-1',
                position: 'right',
                display: true
            }]
        },
    };
    var op = opAni;
    if (document.cookie.match(/scrollTop=([^;]+)(;|$)/) != null)
        op = opNo;
    var drawCha = 0;
    var drawPre = 0;
    var drawFin = 0;
    var drawTec = 0;
    op = opAni;

    window.onbeforeunload = function () {
        var scrollPos;
        scrollPos = document.body.scrollTop;
        document.cookie = "scrollTop=" + scrollPos; //儲存滾動條位置到cookies中
        document.cookie = "cha=" + chaNum;
        document.cookie = "pre=" + preDay;
        document.cookie = "fin=" + finNum;
        document.cookie = "tec=" + tecNum;
    }


    if (document.cookie.match(/scrollTop=([^;]+)(;|$)/) != null) {
        var arr = document.cookie.match(/scrollTop=([^;]+)(;|$)/); //cookies中不為空,則讀取滾動條位置
        document.documentElement.scrollTop = parseInt(arr[1]);
        document.body.scrollTop = parseInt(arr[1]);

        var reChaNum = document.cookie.match(/cha=([^;]+)(;|$)/);
        butCha(reChaNum[1]);
        var rePreNum = document.cookie.match(/pre=([^;]+)(;|$)/);
        preDay = parseInt(rePreNum[1]);
        butPre(0);
        var reFinNum = document.cookie.match(/fin=([^;]+)(;|$)/);
        butFin(reFinNum[1]);
        var reTecNum = document.cookie.match(/tec=([^;]+)(;|$)/);
        butTec(reTecNum[1]);
        {% if toArt == "2" %}
        document.getElementById("artcile").scrollIntoView();
        intoArt(0);
        {% elif toArt == "1" %}
        document.getElementById("artcile").scrollIntoView();
        {% elif toArt == "3" %}
        document.getElementById("artcile").scrollIntoView();
        intoArt({{inArt}});
        {% endif %}
        
    }

    
    </script>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                {% if message[0] == "訊" %}
                    <script type="text/javascript">
                        alert("{{message[1:]}}")
                    </script>
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endwith %}
    {% block body %}{% endblock %}
</body>
</html>
